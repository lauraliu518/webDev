<!DOCTYPE html>
<html>
    <head>
        <title>Gotta Catch 'em All</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div id="container">
            <div id="top">
                <div id="left">
                    <!-- background + grasses -->
                    <img id="background" src="images/environment_forestbackground.png">
                    <img id="grass1" class="grass" src="images/grass.png">
                    <img id="grass2" class="grass" src="images/grass.png">
                    <img id="grass3" class="grass" src="images/grass.png">
                </div>
                <div id="right">
                    <!-- instructions & output (text) + play again button -->
                    <h1>Gotta Catch 'em All</h1>
                    <p>Instructions ......</p>
                    <p id="superModeMessage">You are in SUPER MODE! Good Luck!</p>
                    <h2>Results</h2>
                    <p id="results">You caught a ...</p>
                    <p id="pokeLeftMes">Pokeballs left: <span id="pokeballs_left">5</span></p>
                    <p id="pokeCaughtMes">Pokemon caught: <span id="pokemon_caught">0</span></p>
                    <button id="button_playagain" style="display: none;">Play Again</button>
                    <h3 id="prevResultsTitle" style="display: none;">Your previous result history:</h3>
                    <p id="prevResultsContent" style="display: none;"></p>
                    <button id="reset" style="display: none;">Start Over</button>
    
                </div>
            </div>
            <div id="pokedex">
                <div id="pokemonName">
                    <div class="histHeader">Pokemon</div>
                    <div>Pikachu</div>
                    <div>Bulbasaur</div>
                    <div>Charmander</div>
                    <div>Eevee</div>
                    <div>Squirtle</div>
                    <div>[RARE POKEMON: Reshiram]</div>
                    <div>[RARE POKEMON: Mewtwo]</div>
                </div>
                <div id="count" >
                    <div class="histHeader">Count</div>
                    <div id="pc"></div>
                    <div id="bc"></div>
                    <div id="cc"></div>
                    <div id="ec"></div>
                    <div id="sc"></div>
                    <div id="rc"></div>
                    <div id="mc"></div>
                </div>
                <div id="histogram">
                    <div class="histHeader">Histogram</div>
                    <div id="ph" class="histItem"></div>
                    <div id="bh" class="histItem"></div>
                    <div id="ch" class="histItem"></div>
                    <div id="eh" class="histItem"></div>
                    <div id="sh" class="histItem"></div>
                    <div id="rh" class="histItem"></div>
                    <div id="mh" class="histItem"></div>
                </div>
            </div>

        </div>

        <script>
            // define all DOM elements that we plan on using
            const grass1 = document.getElementById('grass1');
            const grass2 = document.getElementById('grass2');
            const grass3 = document.getElementById('grass3');
            const grasses = document.getElementsByClassName("grass");
            const results = document.getElementById('results');
            const pokeballs_left = document.getElementById('pokeballs_left');
            const pokemon_caught = document.getElementById('pokemon_caught');
            const button_playagain = document.getElementById('button_playagain');
            const reset = document.getElementById("reset");
            const prevRTitle = document.getElementById("prevResultsTitle");
            const prevRConent = document.getElementById("prevResultsContent");
            const pokeLeftMes = document.getElementById("pokeLeftMes");
            const pokeCaughtMes = document.getElementById("pokeCaughtMes");
            //histogram bar section
            const plen = document.getElementById("ph");
            const blen = document.getElementById("bh");
            const clen = document.getElementById("ch");
            const elen = document.getElementById("eh");
            const slen = document.getElementById("sh");
            const rlen = document.getElementById("rh");
            const mlen = document.getElementById("mh");
            //histogram count section
            const pc = document.getElementById("pc");
            const bc = document.getElementById("bc");
            const cc = document.getElementById("cc");
            const ec = document.getElementById("ec");
            const sc = document.getElementById("sc");
            const rc = document.getElementById("rc");
            const mc = document.getElementById("mc");
            //super mode variables
            const superModeMessage = document.getElementById("superModeMessage");
            //define pokemons, initialize local count and reference to html
            let pokemons = ["pikachu", "bulbasaur", "charmander", "eevee", "squirtle", "reshiram", "mewtwo"];
            let pokemonsCount  = [0, 0, 0, 0, 0, 0, 0];
            let pokemonHistRefs = [pc, bc, cc, ec, sc, rc, mc];
            let pokemonHistBars = [plen, blen, clen, elen, slen, rlen, mlen];
            // variables to keep track of game state
            let pokeballsLeft = 5;
            let pokemonCaught = 0;
            //flag for selection
            let selectionAllowed = true;
            // previous results
            let prevResults = [];
            console.log("len:"+pokemons.length);
            for(let i = 0; i < pokemons.length; i++){
                pokemonHistRefs[i].innerText = pokemonsCount[i];
            }
            //Super mode variables
            let superModeProbabilityOutOf100 = 20;
            let superModeFlag = generateSuperFlag(superModeProbabilityOutOf100);
            if(superModeFlag){
                superModeMessage.style.display = "block";
            }
            console.log(superModeFlag);
            let superItems = ["reshiram", "mewtwo", "pokeballs"];


            
            

            // work with grass1 
            grass1.onclick = function() {
                if(selectionAllowed == true){
                    selectionAllowed = false;
                    pokeballsLeft -= 1;
                    pokeballs_left.innerText = pokeballsLeft;
                    generateOpaqueSrc(grass2);
                    generateOpaqueSrc(grass3);
                    // 33% of a pokemon
                    if (chance >= 0.66) {
                        let pokemonName = pokemons[parseInt(Math.random()*5)];
                        grass1.src = "images/"+ pokemonName + ".png";         
                        pokemonCaught += 1;
                        for(let i = 0; i < pokemons.length; i++){
                            if(pokemons[i] == pokemonName){
                                pokemonsCount[i] += 1;
                                updateHist(pokemonsCount, pokemonCaught);
                            }
                        }
                        pokemon_caught.innerText = pokemonCaught;  
                        results.innerText = "You caught a " + pokemonName + "!";
                        prevResults.push(pokemonName);
                    }
                    // 33% of 2 pokeballs 
                    else if (chance >= 0.33 && chance < 0.66) { 
                        grass1.src = 'images/pokeballs.png';                            
                        pokeballsLeft += 2;
                        pokeballs_left.innerText = pokeballsLeft;
                        results.innerText = "You gained two more pokeballs!";
                        prevResults.push("pokeballs");
                    }
                    else if (superModeFlag & chance < 0.2){
                        let pokemonName = superItems[parseInt(Math.random()*3)];
                        if(pokemonName == "pokeballs"){
                            grass1.src = "images/fourpokeballs.png";
                            pokeballsLeft += 4;
                            pokeballs_left.innerText = pokeballsLeft;
                            results.innerText = "You gained four more pokeballs!";
                        }else{
                            pokemonCaught += 1;
                            grass1.src = "images/" + pokemonName + ".png";
                            for(let i = 0; i < pokemons.length; i++){
                                if(pokemons[i] == pokemonName){
                                    pokemonsCount[i] += 1;
                                    updateHist(pokemonName, pokemonsCount, pokemonCaught);
                                }
                            }
                            pokemon_caught.innerText = pokemonCaught;  
                            results.innerText = "You caught a " + pokemonName + "!";
                            prevResults.push(pokemonName);
                        }    
                    }
                    // 33% of nothing
                    else {
                        grass1.src = '';     
                        results.innerText = "You didn't find anything...";    
                        prevResults.push("nothing");                 
                    }   
                    if(pokeballsLeft > 0){
                        // show the reset button
                        button_playagain.style.display = 'block';  
                        plen.style.width = 0.2;
                    }   
                    if(pokeballsLeft == 0){
                        results.style.display = "none";
                        pokeLeftMes.style.display = "none";
                        pokeCaughtMes.style.display = "none";
                        reset.style.display = 'block';
                        prevRTitle.style.display = 'block';
                        //put prev result into string
                        let mes = "";
                        for(let i = 0; i < prevResults.length-1; i++){
                            mes = mes + prevResults[i] + " found, "
                        }
                        mes = mes + prevResults[prevResults.length-1] + " found."
                        prevRConent.innerText = mes;
                        prevRConent.style.display = 'block';
                        updateHist(pokemonsCount, pokemonCaught);
                    }
                }
            }


            // work with grass1 
            grass2.onclick = function() {
                if(selectionAllowed == true){
                    selectionAllowed = false;
                    pokeballsLeft -= 1;
                    pokeballs_left.innerText = pokeballsLeft;
                    generateOpaqueSrc(grass1);
                    generateOpaqueSrc(grass3);
                    // 33% of a pokemon
                    if (chance >= 0.66) {
                        let pokemonName = pokemons[parseInt(Math.random()*5)];
                        grass2.src = "images/"+ pokemonName + ".png";         
                        pokemonCaught += 1;
                        for(let i = 0; i < pokemons.length; i++){
                            if(pokemons[i] == pokemonName){
                                pokemonsCount[i] += 1;
                                updateHist(pokemonsCount, pokemonCaught);
                            }
                        }
                        pokemon_caught.innerText = pokemonCaught;  
                        results.innerText = "You caught a " + pokemonName + "!";
                        prevResults.push(pokemonName);
                    }
                    // 33% of 2 pokeballs 
                    else if (chance >= 0.33) { //chance >= 0.33 && chance < 0.66
                        grass2.src = 'images/pokeballs.png';                            
                        pokeballsLeft += 2;
                        pokeballs_left.innerText = pokeballsLeft;
                        results.innerText = "You gained two more pokeballs!";
                        prevResults.push("pokeball");
                    }
                    // 33% of nothing
                    else {
                        grass2.src = '';     
                        results.innerText = "You didn't find anything...";    
                        prevResults.push("nothing");                 
                    }   
                    if(pokeballsLeft > 0){
                        // show the reset button
                        button_playagain.style.display = 'block';  
                        plen.style.width = 0.2;
                    }   
                    if(pokeballsLeft == 0){
                        results.style.display = "none";
                        pokeLeftMes.style.display = "none";
                        pokeCaughtMes.style.display = "none";
                        reset.style.display = 'block';
                        prevRTitle.style.display = 'block';
                        //put prev result into string
                        let mes = "";
                        for(let i = 0; i < prevResults.length-1; i++){
                            mes = mes + prevResults[i] + " found, "
                        }
                        mes = mes + prevResults[prevResults.length-1] + " found."
                        prevRConent.innerText = mes;
                        prevRConent.style.display = 'block';
                        updateHist(pokemonsCount, pokemonCaught);
                    }
                }
            }

            // work with grass3 
            grass3.onclick = function() {
                if(selectionAllowed == true){
                    selectionAllowed = false;
                    pokeballsLeft -= 1;
                    pokeballs_left.innerText = pokeballsLeft;
                    generateOpaqueSrc(grass2);
                    generateOpaqueSrc(grass1);
                    // 33% of a pokemon
                    if (chance >= 0.66) {
                        let pokemonName = pokemons[parseInt(Math.random()*5)];
                        grass3.src = "images/"+ pokemonName + ".png";         
                        pokemonCaught += 1;
                        for(let i = 0; i < pokemons.length; i++){
                            if(pokemons[i] == pokemonName){
                                pokemonsCount[i] += 1;
                                updateHist(pokemonsCount, pokemonCaught);
                            }
                        }
                        pokemon_caught.innerText = pokemonCaught;  
                        results.innerText = "You caught a " + pokemonName + "!";
                        prevResults.push(pokemonName);
                    }
                    // 33% of 2 pokeballs 
                    else if (chance >= 0.65) { //chance >= 0.33 && chance < 0.66
                        grass3.src = 'images/pokeballs.png';                            
                        pokeballsLeft += 2;
                        pokeballs_left.innerText = pokeballsLeft;
                        results.innerText = "You gained two more pokeballs!";
                        prevResults.push("pokeball");
                    }
                    // 33% of nothing
                    else {
                        grass3.src = '';     
                        results.innerText = "You didn't find anything...";    
                        prevResults.push("nothing");                 
                    }   
                    if(pokeballsLeft > 0){
                        // show the reset button
                        button_playagain.style.display = 'block';  
                        plen.style.width = 0.2;
                    }   
                    if(pokeballsLeft == 0){
                        results.style.display = "none";
                        pokeLeftMes.style.display = "none";
                        pokeCaughtMes.style.display = "none";
                        reset.style.display = 'block';
                        prevRTitle.style.display = 'block';
                        //put prev result into string
                        let mes = "";
                        for(let i = 0; i < prevResults.length-1; i++){
                            mes = mes + prevResults[i] + " found, "
                        }
                        mes = mes + prevResults[prevResults.length-1] + " found."
                        prevRConent.innerText = mes;
                        prevRConent.style.display = 'block';
                        updateHist(pokemonsCount, pokemonCaught);
                    }
                }
            }

            grasses.onclick = function(){
                console.log("hello");
                if(pokeballsLeft == 0){
                    console.log("done");
                    console.log(prevResults);
                }
                console.log(pokeballsLeft)
            }

            // reset button 
            button_playagain.onclick = function() {
                // reset the grasses 
                grass1.src = 'images/grass.png';
                grass1.style.opacity = 1;
                grass2.src = 'images/grass.png';
                grass2.style.opacity = 1;
                grass3.src = 'images/grass.png';
                grass3.style.opacity = 1;


                // hide the play again button
                button_playagain.style.display = 'none';
                selectionAllowed = true;
            }

            // restart game button 
            reset.onclick = function() {
                //reset the game section 
                //reset grass
                grass1.src = 'images/grass.png';
                grass1.style.opacity = 1;
                grass2.src = 'images/grass.png';
                grass2.style.opacity = 1;
                grass3.src = 'images/grass.png';
                grass3.style.opacity = 1;
                //reset game result section
                pokeballsLeft = 5;
                pokeballs_left.innerText = pokeballsLeft;
                pokemonCaught = 0;
                pokemon_caught.innerText = pokemonCaught;
                prevResults = [];
                selectionAllowed = true;
                //reset histogram
                pokemonsCount  = [0, 0, 0, 0, 0, 0, 0];
                for(let i = 0; i < pokemons.length; i++){
                    pokemonHistRefs[i].innerText = pokemonsCount[i];
                    pokemonHistBars[i].style.width = "0%";
                }
                // hide the recap section contents
                reset.style.display = 'none';
                prevRTitle.style.display = 'none';
                prevRConent.style.display = 'none';
                prevRConent.innerText = "";
                //show updated results
                results.innerText = "";
                results.style.display = "block";
                pokeLeftMes.style.display = "block";
                pokeCaughtMes.style.display = "block";
                //reset super mode
                superModeFlag = generateSuperFlag(superModeProbabilityOutOf100);
                if(superModeFlag){
                    superModeMessage.style.display = "block";
                }
            }

            function generateOpaqueSrc(myEle){
                chance = Math.random();
                if(chance >= 0.66){
                    let pokemonName = pokemons[parseInt(Math.random()*5)];
                    myEle.src = "images/"+ pokemonName + ".png";     
                }else if (chance >= 0.33){
                    myEle.src = "images/pokeballs.png"; 
                }else{
                    myEle.src = "";
                }
                myEle.style.opacity = 0.5;
            }

            function updateHist(pokemonName, pokemonsCount, pokemonCaught){
                for (let i = 0; i < pokemons.length; i++){
                    pokemonHistRefs[i].innerText = pokemonsCount[i];
                    pokemonHistBars[i].style.width = (pokemonsCount[i]/pokemonCaught)*100 + "%";
                }
            }

            function generateSuperFlag(prob){
                generatedNum = Math.random();
                if(generatedNum < prob/100){
                    console.log("generatednum", generatedNum);
                    console.log("prob", prob/100);
                    return true;
                }else{
                    return false;
                }
            }



        </script>
    </body>
</html>